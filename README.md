# Покупка билетов в кино

## Описание системы
Система позволяет:  
 - просмотреть расписание фильмов на текущую дату
 - выбрать фильм и выбрать свободное место в зале. Место имеет 3 состояния: свободно, занято, куплено мною 
 - просмотреть список моих билетов. На 1 фильм можно купить несколько билетов
 - билет несет полную информацию о сеансе: фильм, зал, место
 - можно заходить под разными пользователями и видеть свободные места

## Настройка проекта
Создать в корне `.env` файл или выполнить команду `cp .env.example .env`.  
Важно: новый файл должен содержать **все** настройки из файла `.env.example` в случае ручного создания

### Запуск Tg Bot
1) Создать telegramm bot и получить его token. Как создать бота - описано ниже в инструкции
2) Прописать полученный token бота в созданный ранее файл `.env` в настройку `TELEGRAM_BOT_API_TOKEN=`
3) Выполнить команду в корне `make run-bot`
4) В телеграмме зайти в созданного ранее бота и нажать start(запуск бота)


#### Создание нового бота
Для создания бота нужно перейти по сылке [botfather](https://t.me/botfather) и следовать инструкции. Полученный token записать в `.env` файл в поле `TELEGRAM_BOT_API_TOKEN=`

### Запуск gRPC server-client
1) В `.env` файле пропишите порты, на которых хотите поднять сервер. По-умолчанию уже стоят 8081(grpc) и 8090(rest)
2) Команда `make run-server` запускает сервер + resp proxy
3) Команда `make run-client` запускает клиента(если надо).
4) В корне сайта лежит файл `rest-api.http`, в котором описаны все rest comands как примеры. Рабочие и можно их запускать

#### Особенность gRPC server 

Т к билеты в кино покупать могут разные пользователи, то пользователя надо как-то идентифицировать. Если в случае tgBot мы сразу знали имя и id пользователя,
то чтобы не ломать всю логику была создана упрощенная аудентификация по токену, который состоит из "name-id" пользователя.  
**Токен** получить можно командой `curl -X POST http://localhost:8090/v1/auth -d '{"name": "dima"}'`.  
Далее в каждом запросе в **header** надо будет слать заголовок, например `Token: dido-1`

#### Swagger (json)

Сваггер доступен попути `http://localhost:8090/v1/swagger`. Порт береться из настройки окружения `REST_PORT=`
